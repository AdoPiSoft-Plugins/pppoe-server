"use strict";var spawn=require("child_process").spawn;module.exports=(command_str,opts)=>{var delay=(opts=opts||{}).delay||0,shell=!!opts.shell,args=(command_str=command_str.trim().replace(/  +/g," ")).split(" "),cmd=args.splice(0,1),error=null,done=!1;return new Promise((resolve,reject)=>{var exec=spawn(cmd[0],args,{shell:shell});exec.stderr.on("data",err=>{err&&(error=error?error+"\n"+err.toString():err.toString())}),"function"==typeof opts.onData&&exec.stdout.on("data",msg=>{msg=msg.toString(),opts.onData(msg)}),exec.on("error",err=>{done||(error=err.toString(),done=!0,reject(error))}),exec.on("close",code=>{done||(done=!0,error||0!=code?reject(error):0<delay?setTimeout(()=>resolve(code),delay):resolve(code))})})};