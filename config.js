"use strict";var ini_file,ini=require("ini"),util=require("util"),fs=require("fs"),read_file=util.promisify(fs.readFile),write_text=util.promisify(fs.writeFile),chmod=util.promisify(fs.chmod),path=require("path"),cmd=require("./lib/cmd.js");"development"==process.env.NODE_ENV?(ini_file=process.env.PPPOE_CONFIG_PATH||path.join(process.env.APPDIR,"tmp","ppp","pppoe-config.ini"),process.env.CHAP_PATH=process.env.CHAP_PATH||path.join(process.env.APPDIR,"tmp","ppp","chap-secrets"),process.env.IPADDRESS_POOL=process.env.IPADDRESS_POOL||path.join(process.env.APPDIR,"tmp","ppp","ipaddress_pool")):ini_file=process.env.PPPOE_CONFIG_PATH||path.join("/etc","ppp","pppoe-config.ini");var mode=438;exports.server_started=!1,exports.startServer=async()=>{if(!exports.server_started)try{var cfg=await exports.read();if(!cfg.interface)throw new Error("Interface not yet setup");exports.server_started=!0,await cmd(`${path.join(__dirname,"scripts/start.sh")} ${cfg.interface}`)}catch(e){}},exports.restartServer=()=>(exports.server_started=!1,exports.startServer()),exports.read=async()=>read_file(ini_file,"utf8").then(txt=>ini.decode(txt||"")||{}).catch(e=>({})),exports.save=async cfg=>write_text(ini_file,ini.stringify(cfg),{mode:mode}).then(()=>chmod(ini_file,mode)).then(()=>cfg);